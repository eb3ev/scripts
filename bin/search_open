#!/bin/sh

. "$SCRIPTS_HOME/scriptsrc"
. "$lib/var/config"
. "$lib/lines"
. "$lib/files"
. "$lib/args"

use_filter="false"
new_window="false"
require_sudo="false"

prompt="Open"

get_file() {
    IFS="
" 
    find_cmd $1 --include-hidden | filter --use-pipe $2 | menu --prompt="$prompt"
}

open_file() {
    if [ "$require_sudo" = "true" ]
    then
        SUDO_ASKPASS="$bin/passwd_prompt" sudo -A ${override_cmd:-xdg-open} "$1"
    else
        ${override_cmd:-xdg-open} "$1"
    fi
}

directories=""
filters=""

for arg in "$@"
do
    case "$arg" in
        "--sudo") require_sudo="true" ;;
        "--filter-txt") filters=$(list_add "$filters" "--txt") ;;
        "--filter-doc") filters=$(list_add "$filters" "--doc") ;;
        "--filter-img") filters=$(list_add "$filters" "--img") ;;
        "--filter-vid") filters=$(list_add "$filters" "--vid") ;;
        "--filter-archive") filters=$(list_add "$filters" "--archive") ;;
        "--prompt="*) prompt=$(get_arg_value "--prompt=" "$arg") ;;
        *)
            if [ -d "$arg" ]
            then
                directories=$(list_add "$directories" "$arg")
            fi
            ;;
    esac
done

file=$(get_file "$directories" "$filters")

if [ -n "$file" ]
then
    open_file "$file"
fi

