#!/bin/sh

. "${SCRIPTS_DIR:-${0%/*}/..}/scriptsrc"
. "$lib/var/config"

window_menu() {
    case "$1" in
        0) eval "$base_dmenu $param0" ;;
        1) eval "$base_dmenu $param1" ;;
        2) eval "$base_dmenu $param2" ;;
        3) eval "$base_dmenu $param3" ;;
        4) eval "$base_dmenu $param4" ;;
        5) eval "$base_dmenu $param5" ;;
        *) eval "$base_dmenu" ;;
    esac
}

default_menu() {
    base_dmenu="dmenu"
    param0=""
    param1=""
    param2=""
    param3=""
    param4=""
    param5=""

    window_menu "$1" "$2"
}

top_window_menu() {
    base_dmenu="dmenu -fn 'Noto Sans-11' -i -h 26 -mn 1 -bw 1 -bc '#FFFFFF'"
    param0="\$2"
    param1="-p \"\$2\""
    param2="-r -p \"\$2\""
    param3="-F -r -p \"\$2\""
    param4="-bw 4 -r -p \"\$2\""
    param5="-P -p ' '"

    window_menu "$1" "$2"
}

center_window_menu() {
    base_dmenu="dmenu -fn 'Noto Sans-14' -nb '#000000' -sb '#000000' \
        -pb '#000000' -i -c -l 5 -mn 1 -h 32 -bw 1 -bc '#FFFFFF'"
    param0="\$2"
    param1="-p \"\$2\""
    param2="-r -p \"\$2\""
    param3="-F -r -p \"\$2\""
    param4="-bw 4 -r -p \"\$2\""
    param5="-l 0 -P -p ' '"

    window_menu "$1" "$2"
}

bottom_window_menu() {
    base_dmenu="dmenu -fn 'Noto Sans-11' -i -b -h 26 -mn 1 -bw 1 -bc '#FFFFFF'"
    param0="\$2"
    param1="-p \"\$2\""
    param2="-r -p \"\$2\""
    param3="-F -r -p \"\$2\""
    param4="-bw 4 -r -p \"\$2\""
    param5="-l 0 -P -p ' '"

    window_menu "$1" "$2"
}

term_menu() {
    FZF_DEFAULT_OPTS='
        --cycle
        --margin 8%,4%,8%
        --info inline
        --preview-window noborder
        --bind alt-j:down
        --bind alt-k:up
        --bind ctrl-d:half-page-down
        --bind ctrl-u:half-page-up
        --color fg:#D0D0D0,bg:-1,hl:#FFFFFF,fg+:#FFFFFF,bg+:-1,gutter:-1
        --color info:#D0D0D0,prompt:#FFFFFF,pointer:#FFFFFF,hl+:#FFFFFF
        --color marker:#FFFFFF,spinner:#FFFFFF,header:#FFFFFF,border:-1
    '
    fzf
}

term_window_menu() {
    read -d '' input

    tmp_file=$(mktemp)

    FZF_DEFAULT_OPTS='
        --cycle
        --margin 8%,4%,8%
        --info inline
        --preview-window noborder
        --bind alt-j:down
        --bind alt-k:up
        --bind ctrl-d:half-page-down
        --bind ctrl-u:half-page-up
        --color fg:#D0D0D0,bg:-1,hl:#FFFFFF,fg+:#FFFFFF,bg+:-1,gutter:-1
        --color info:#D0D0D0,prompt:#FFFFFF,pointer:#FFFFFF,hl+:#FFFFFF
        --color marker:#FFFFFF,spinner:#FFFFFF,header:#FFFFFF,border:-1
    '
    term_exec --no-fork "echo \"$input\" | FZF_DEFAULT_OPTS=\"$FZF_DEFAULT_OPTS\" fzf > \"$tmp_file\""
    value=$(cat "$tmp_file" 2>/dev/null)
    echo "$value"
}

config="${override_menu:-$(cat "$menurc" 2>/dev/null)}"

case "$config" in
    "top_window") top_window_menu "$1" "$2" ;;
    "center_window") center_window_menu "$1" "$2" ;;
    "bottom_window") bottom_window_menu "$1" "$2" ;;
    "term_window") term_window_menu "$1" "$2" ;;
    "term") term_menu ;;
    *) default_menu "$1" "$2" ;;
esac

