#!/bin/sh

. "${SCRIPTS_DIR:-${0%/*}/..}/scriptsrc"
. "$lib/var/config"

window_menu() {
    case "$1" in
        0) eval "$base_dmenu $param0" ;;
        1) eval "$base_dmenu $param1" ;;
        2) eval "$base_dmenu $param2" ;;
        3) eval "$base_dmenu $param3" ;;
        4) eval "$base_dmenu $param4" ;;
        5) eval "$base_dmenu $param5" ;;
        *) eval "$base_dmenu" ;;
    esac
}

default_menu() {
    base_dmenu="dmenu"
    param0=""
    param1=""
    param2=""
    param3=""
    param4=""
    param5=""

    window_menu "$1" "$2"
}

top_window_menu() {
    base_dmenu="dmenu -fn 'Noto Sans-11' -i -h 26 -mn 1 -bw 1 -bc '#FFFFFF'"
    param0="\$2"
    param1="-p \"\$2\""
    param2="-r -p \"\$2\""
    param3="-F -r -p \"\$2\""
    param4="-bw 4 -r -p \"\$2\""
    param5="-P -p ' '"

    window_menu "$1" "$2"
}

center_window_menu() {
    base_dmenu="dmenu -fn 'Noto Sans-14' -nb '#000000' -sb '#000000' \
        -pb '#000000' -i -c -l 5 -mn 1 -h 32 -bw 1 -bc '#FFFFFF'"
    param0="\$2"
    param1="-p \"\$2\""
    param2="-r -p \"\$2\""
    param3="-F -r -p \"\$2\""
    param4="-bw 4 -r -p \"\$2\""
    param5="-l 0 -P -p ' '"

    window_menu "$1" "$2"
}

bottom_window_menu() {
    base_dmenu="dmenu -fn 'Noto Sans-11' -i -b -h 26 -mn 1 -bw 1 -bc '#FFFFFF'"
    param0="\$2"
    param1="-p \"\$2\""
    param2="-r -p \"\$2\""
    param3="-F -r -p \"\$2\""
    param4="-bw 4 -r -p \"\$2\""
    param5="-l 0 -P -p ' '"

    window_menu "$1" "$2"
}

term_menu() {
    fzf
}

term_window_menu() {
    tmp_list=$(mktemp)
    tmp_result=$(mktemp)

    cat > "$tmp_list" 2>/dev/null

    term_exec --no-fork "fzf > \"$tmp_result\" < \"$tmp_list\""

    value=$(cat "$tmp_result" 2>/dev/null)

    rm -f -- "$list" "$result"

    echo "$value"
}

config="${override_menu:-$(cat "$menurc" 2>/dev/null)}"

case "$config" in
    "top_window") top_window_menu "$1" "$2" ;;
    "center_window") center_window_menu "$1" "$2" ;;
    "bottom_window") bottom_window_menu "$1" "$2" ;;
    "term_window") term_window_menu "$1" "$2" ;;
    "term") term_menu ;;
    *) default_menu "$1" "$2" ;;
esac

