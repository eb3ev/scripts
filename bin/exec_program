#!/bin/sh

. "${SCRIPTS_DIR:-$HOME/scripts}/scriptsrc"
. "$lib/var/config"
. "$lib/var/cache"
. "$lib/lines"

run="true"
require_sudo="false"

IFS=:
if stest -dqr -n "$programs" $PATH
then
    stest -flx $PATH | sort -u > "$programs"
fi
unset IFS

if [ ! -e "$program_history" ]
then
    cp "$programs" "$program_history"
fi

sync_file_file "$program_history" "$programs"

for arg in "$@"
do
    case "$arg" in
        "--sudo") require_sudo="true" ;;
        "--print-cmd") run="false" ;;
    esac
done

if [ "$require_sudo" = "true" ]
then
    program="$(menu 4 "Launch" < "$program_history")"
else
    program=$(menu 2 "Launch" < "$program_history")
fi

if [ -n "$program" ]
then
    to_top "$program" "$program_history"

    if [ "$require_sudo" = "true" ]
    then
        if [ "$run" = "true" ]
        then
            SUDO_ASKPASS="$bin/passwd_prompt" sudo -A $program
        else
            echo "SUDO_ASKPASS="$bin/passwd_prompt" sudo -A $program"
        fi
    else
        if [ "$run" = "true" ]
        then
            $program
        else
            echo "$program"
        fi
    fi
fi

