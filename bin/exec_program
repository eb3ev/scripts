#!/bin/sh

. "${SCRIPTS_DIR:-$HOME/scripts}/scriptsrc"
. "$lib/var/config"
. "$lib/var/cache"
. "$lib/lines"

IFS=:
if stest -dqr -n "$programs" $PATH
then
    stest -flx $PATH | sort -u > "$programs"
fi
unset IFS

if [ ! -e "$program_history" ]
then
    cp "$programs" "$program_history"
fi

sync_file_file "$program_history" "$programs"

case "$1" in
    "-s")
        program="$(menu 4 "Launch" < "$program_history")"
        program_prefix="SUDO_ASKPASS=\"$bin/passwd_prompt\" sudo -A"
        ;;
    *)
        program=$(menu 2 "Launch" < "$program_history")
        program_prefix=""
        ;;
esac

if [ -n "$program" ]
then
    prepend_line "$program" "$program_history"

    eval "$program_prefix \"$program\""
fi

