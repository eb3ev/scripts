#!/bin/sh

. "${SCRIPTS_DIR:-${0%/*}/..}/scriptsrc"
. "$lib/var/config"
. "$lib/lines"
. "$lib/files"

use_filter="false"
new_window="false"
require_sudo="false"

get_file() {
    files=$(find_cmd "$1")

    if [ "$use_filter" = "true" ]
    then
        files=$(echo "$files" | filter --use-pipe --txt-files)
    fi

    echo "$files" | menu 1 "Edit"
}

edit_file() {
    if [ "$new_window" = "true" ]
    then
        if [ "$require_sudo" = "true" ]
        then
            term_edit --sudo "$1"
        else
            term_edit "$1"
        fi
    else
        if [ "$require_sudo" = "true" ]
        then
            $sudo_editor "$1"
        else
            $editor "$1"
        fi
    fi
}

directories=""
filter=""

for arg in "$@"
do
    case "$arg" in
        "--new-window") new_window="true" ;;
        "--sudo") require_sudo="true" ;;
        "--use-filter") filter="--filter-txt" ;;
        *)
            if [ -d "$arg" ]
            then
                directories=$(list_add "$directories" "'$arg'")
            fi
            ;;
    esac
done

if [ "$new_window" = "true" ]
then
    if [ "$require_sudo" = "true" ]
    then
        run_cmd="term_edit --sudo"
    else
        run_cmd="term_edit"
    fi
else
    if [ "$require_sudo" = "true" ]
    then
        run_cmd="$sudo_editor"
    else
        run_cmd="$editor"
    fi
fi

eval override_prompt="Edit" override_cmd="$run_cmd" search_open $filter $directories

