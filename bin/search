#!/bin/sh

. "${SCRIPTS_DIR:-${0%/*}/..}/scriptsrc"
. "$lib/var/config"
. "$lib/var/cache"
. "$lib/csv"
. "$lib/lines"

create_histfile() {
    if [ -e "$search_history" ]
    then
        histsize="${search_histsize:-1000}"
        sed -i "$histsize,\$d" "$search_history"
    else
        echo > "$search_history"
    fi
    echo "true"
} 

search_engine_key=$(keys --file="$search_engines" | menu 2 "ï€‚")

if [ -n "$search_engine_key" ]
then
    if [ "$(create_histfile)" = "true" ]
    then
        query=$(menu 1 "$search_engine_key" < "$search_history")

        
        if [ -n "$query" ]
        then
            to_top "$query" "$search_history"

            query=$(enc --html "$query")

            ${1:-xdg-open} "$(value --key="$search_engine_key" --file="$search_engines")$query"
        fi
    fi
fi

